<div class="calculator-container">
  <!-- ================= INPUT PANEL ================= -->
  <div class="input-panel">
    <h3 class="panel-title">Combined Investment Parameters</h3>

    <div class="input-group">
      <label>Initial Lumpsum Investment (₹)</label>
      <input type="number" [(ngModel)]="lumpsumInvestment" />
    </div>

    <div class="input-group">
      <label>Monthly SIP Investment (₹)</label>
      <input type="number" [(ngModel)]="monthlyInvestment" />
    </div>

    <div class="input-group">
      <label>Expected Return (% p.a)</label>
      <input type="number" [(ngModel)]="expectedRate" />
    </div>

    <div class="input-group">
      <label>Period of Investment (Years)</label>
      <input type="number" [(ngModel)]="periodInYears" />
    </div>

    <button class="analyze-button" (click)="analyze()">
      <i class="fas fa-chart-line"></i> Analyze Combined Growth
    </button>

    <div class="chart-container" *ngIf="isCalculated">
      <h4 class="chart-title">Corpus Allocation</h4>
      <div class="donut-chart-wrapper">
        <div
          class="donut-chart"
          [style.--returns-percent]="returnsPercentage + '%'"
        >
          <span class="center-text">
            <small>Total Value</small>
            {{ formatCurrency(finalValue) }}
          </span>
        </div>
      </div>

      <div class="chart-legend">
        <div class="legend-item">
          <span class="color-box invested-color"></span> Invested ({{
            investedPercentage
          }}%)
        </div>
        <div class="legend-item">
          <span class="color-box returns-color"></span> Returns ({{
            returnsPercentage
          }}%)
        </div>
      </div>
    </div>
  </div>

  <!-- ================= OUTPUT PANEL ================= -->
  <div class="output-panel" *ngIf="isCalculated">
    <!-- SUMMARY -->
    <h3 class="panel-title">Accumulated Corpus</h3>
    <div class="summary-card">
      <div class="summary-item">
        <span class="label">Total Invested</span><br /><br />
        <span class="value invested">{{
          formatCurrency(finalInvestment)
        }}</span>
      </div>
      <div class="summary-item">
        <span class="label">Est. Returns</span><br /><br />
        <span class="value returns">{{ formatCurrency(finalReturns) }}</span>
      </div>
      <div class="summary-item">
        <span class="label total-label">Total Value</span><br /><br />
        <span class="value total">{{ formatCurrency(finalValue) }}</span>
      </div>
    </div>

    <!-- ================= YEAR-WISE ================= -->
    <div class="table-header-row">
      <h3 class="panel-title table-title">Year-wise Growth</h3>
      <div class="download-icons">
        <button
          class="icon-button excel-icon"
          (click)="downloadYearWiseExcel()"
          title="Download as Excel"
        >
          <i class="fas fa-file-excel"></i>
        </button>
        <button
          class="icon-button pdf-icon"
          (click)="downloadYearWisePdf()"
          title="Download as PDF"
        >
          <i class="fas fa-file-pdf"></i>
        </button>
      </div>
    </div>

    <div class="table-scroll">
      <table class="growth-table" id="yearWiseTable">
        <thead>
          <tr>
            <th>Year</th>
            <th>Invested</th>
            <th>Returns</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let y of yearWiseGrowth">
            <td>{{ y.yearLabel }}</td>
            <td>{{ formatCurrency(y.investedAmount) }}</td>
            <td>{{ formatCurrency(y.estimatedReturns) }}</td>
            <td>{{ formatCurrency(y.totalValue) }}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- ================= MONTH-WISE ================= -->
    <div class="table-header-row">
      <h3 class="panel-title table-title">
        Month-wise Growth
        <small>({{ totalMonths }} Months)</small>
      </h3>
      <div class="download-icons">
        <button
          class="icon-button excel-icon"
          (click)="downloadMonthWiseExcel()"
          title="Download as Excel"
        >
          <i class="fas fa-file-excel"></i>
        </button>
        <button
          class="icon-button pdf-icon"
          (click)="downloadMonthWisePdf()"
          title="Download as PDF"
        >
          <i class="fas fa-file-pdf"></i>
        </button>
      </div>
    </div>

    <div class="table-scroll">
      <table class="growth-table" id="monthWiseTable">
        <thead>
          <tr>
            <th>Month</th>
            <th>Amount (₹)</th>
            <th>Return (₹)</th>
            <th>Total (₹)</th>
            <th>Return Rate (per month)</th>
            <th>Monthly Investment (₹)</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let m of monthWiseGrowth">
            <td>{{ m.month }}</td>
            <td>{{ formatCurrency(m.amountBeforeInterest) }}</td>
            <td>{{ formatCurrency(m.monthlyReturnAmount) }}</td>
            <td>{{ formatCurrency(m.totalValue) }}</td>
            <td>{{ m.monthlyReturnRate }}</td>
            <td>{{ formatCurrency(m.monthlyInvestment) }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<div class="calculator-container">
  <div class="input-panel">
    <h3 class="panel-title">SWP Withdrawal Parameters</h3>

    <div class="input-group">
      <label>Initial Corpus (₹)</label>
      <input type="number" [(ngModel)]="initialCorpus" min="1" />
    </div>

    <div class="input-group">
      <label>Monthly Withdrawal (₹)</label>
      <input type="number" [(ngModel)]="monthlyWithdrawal" min="0" />
    </div>

    <div class="input-group">
      <label>Expected Return (% p.a)</label>
      <input type="number" [(ngModel)]="expectedRate" min="1" max="50" />
    </div>

    <div class="input-group">
      <label>Period of Withdrawal (Years)</label>
      <input
        type="number"
        [(ngModel)]="periodInYears"
        min="0.01"
        step="0.01"
        max="60"
      />
    </div>

    <button class="analyze-button" (click)="analyze()">
      <i class="fas fa-chart-line"></i> Analyze Growth
    </button>

    <div class="chart-container" *ngIf="isCalculated">
      <h4 class="chart-title">Corpus Allocation</h4>
      <div class="donut-chart-wrapper">
        <div
          class="donut-chart"
          [style.--returns-percent]="returnsPercentage + '%'"
        >
          <span class="center-text">
            <small>Remaining Value</small>
            {{ formatCurrency(finalValue) }}
          </span>
        </div>
      </div>

      <div class="chart-legend">
        <div class="legend-item">
          <span class="color-box invested-color"></span> Invested ({{
            investedPercentage
          }}%)
        </div>
        <div class="legend-item">
          <span class="color-box returns-color"></span> Returns ({{
            returnsPercentage
          }}%)
        </div>
      </div>
    </div>
  </div>

  <div class="output-panel" *ngIf="isCalculated">
    <h3 class="panel-title">SWP Summary</h3>

    <div class="summary-card">
      <div class="summary-item">
        <span class="label">Initial Corpus</span>
        <span class="value invested">{{
          formatCurrency(finalInvestment)
        }}</span>
      </div>
      <div class="summary-item">
        <span class="label">Est. Returns</span>
        <span class="value returns">{{ formatCurrency(finalReturns) }}</span>
      </div>
      <div class="summary-item">
        <span class="label total-label">Remaining Value</span>
        <span class="value total">{{ formatCurrency(finalValue) }}</span>
      </div>
    </div>

    <div class="table-header-row">
      <h3 class="panel-title table-title">Year-wise Growth Projection</h3>
      <div class="download-icons">
        <button
          class="icon-button excel-icon"
          (click)="downloadExcel()"
          title="Download as Excel"
        >
          <i class="fas fa-file-excel"></i>
        </button>
        <button
          class="icon-button pdf-icon"
          (click)="downloadPdf()"
          title="Download as PDF"
        >
          <i class="fas fa-file-pdf"></i>
        </button>
      </div>
    </div>

    <div class="table-scroll">
      <table class="growth-table" id="yearWiseTable">
        <thead>
          <tr>
            <th>Year</th>
            <th>Invested Amount (₹)</th>
            <th>Est. Returns (₹)</th>
            <th>Total Value (₹)</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let data of yearWiseGrowth">
            <td>{{ data.yearLabel || data.year }}</td>
            <td>{{ formatCurrency(data.investedAmount) }}</td>
            <td>{{ formatCurrency(data.estimatedReturns) }}</td>
            <td>{{ formatCurrency(data.totalValue) }}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- MONTH-WISE -->
    <div class="table-header-row">
      <h3 class="panel-title table-title">
        Month-wise Growth <small>({{ totalMonths }} Months)</small>
      </h3>
      <div class="download-icons">
        <button
          class="icon-button excel-icon"
          (click)="downloadMonthWiseExcel()"
          title="Download month-wise Excel"
        >
          <i class="fas fa-file-excel"></i>
        </button>
        <button
          class="icon-button pdf-icon"
          (click)="downloadMonthWisePdf()"
          title="Download month-wise PDF"
        >
          <i class="fas fa-file-pdf"></i>
        </button>
      </div>
    </div>

    <div class="table-scroll">
      <table class="growth-table" id="monthWiseTable">
        <thead>
          <tr>
            <th>Month</th>
            <th>Amount (₹)</th>
            <th>Withdrawal (₹)</th>
            <th>Return (₹)</th>
            <th>Total (₹)</th>
            <th>Return Rate (per month)</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let m of monthWiseGrowth">
            <td>{{ m.month }}</td>
            <td>{{ formatCurrency(m.amountBeforeInterest) }}</td>
            <td>{{ formatCurrency(m.withdrawalAmount) }}</td>
            <td>{{ formatCurrency(m.monthlyReturnAmount) }}</td>
            <td>{{ formatCurrency(m.totalValue) }}</td>
            <td>{{ m.monthlyReturnRate }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
